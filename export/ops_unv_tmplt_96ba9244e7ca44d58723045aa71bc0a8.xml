<?xml version="1.0" encoding="UTF-8"?><unload unload_date="2020-01-09 08:57:56" unload_format="1" unload_table="ops_unv_tmplt" unload_version="6.7.0.0"><ops_unv_tmplt action="INSERT_OR_UPDATE"><credentials_var/><agent/><icon_date_created>2019-12-12 12:11:30</icon_date_created><sys_updated_on>2019-12-13 09:59:54</sys_updated_on><output_return_text/><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:09:53</sys_created_on><agent_cluster_var/><agent_cluster_var_check>false</agent_cluster_var_check><wait_for_output>false</wait_for_output><sys_created_by>i.kyriazidou</sys_created_by><output_return_nline>100</output_return_nline><exit_code_text/><exit_code_fr>0</exit_code_fr><runtime_dir/><output_return_type>1</output_return_type><script>#!/opt/universal/python3.6/bin/python3

"""
         Origins: Stonebranch GmbH
          Author: Ioanna Kyriazidou
            Date: 06-Nov-2019

    Copyright (c) Stonebranch GmbH, 2019.  All rights reserved.

    The copyright in this work is vested in Stonebranch.
    The information contained in this work (either in whole or in part)
    is confidential and must not be modified, reproduced, disclosed or
    disseminated to others or used for purposes other than that for which
    it is supplied, without the prior written permission of Stonebranch.
    If this work or any part hereof is furnished to a third party by
    virtue of a contract with that party, use of this work by such party
    shall be governed by the express contractual terms between Stonebranch, which
    is party to that contract and the said party.

    The information in this document is subject to change without notice
    and should not be construed as a commitment by Stonebranch. Stonebranch assumes no
    responsibility for any errors that may appear in this document. With
    the appearance of a new version of this document all older versions
    become invalid.
"""

import pymsteams
import logging
import sys

from pymsteams import TeamsWebhookException

logging.basicConfig(stream=sys.stdout, level=logging.${ops_var_logging_level}, format=' %(asctime)s - %(levelname)s - %(message)s')

    
def send_mt_msg(web_hook, title, text):
    ''' 
        send_mt_msg() is a python 3 function that set up a Microsoft teams connections via a incoming web hook
        and then sends a message to this MT channel. The message is consisted by a title and a text. 
        
        web_hook (string)   - The incoming web hook of Microsoft Teams channel
        title(string)       - The title of the message sent to Microsoft Teams channel
        text(string)        - The text of the message sent to Microsoft Teams channel
    '''  
  
    # create the connectorcard object with the Microsoft Webhook URL
    logging.debug("Establishing a MT connection via web hook...")
    ms_connector = pymsteams.connectorcard(web_hook)
    #logging.debug("Established.")
    
    ms_connector.title(title)
    logging.debug("Title: " + title)
    ms_connector.text(text)
    logging.debug("Text: " + text)
    
    try:
        ms_connector.send()
    except:
        logging.error("UAC failed to forward a message in this Microsoft Teams Channel.")
        raise TeamsWebhookException
        sys.exit()
        
    logging.debug("Message Payload: ")
    
    ms_connector.printme()
        

if __name__== "__main__":

    logging.info("Microsoft Teams Notifications process started...")
    send_mt_msg("${ops_var_web_hook}", "${ops_var_title}", "${ops_var_text}")
    logging.info("Microsoft Teams Notifications process finished...")</script><broadcast_cluster_var_check>false</broadcast_cluster_var_check><agent_type>1</agent_type><script_type_windows>uapy</script_type_windows><automatic_output_fr>0</automatic_output_fr><agent_cluster/><name>Send Mesage to Microsoft Teams Channel</name><exit_codes>0</exit_codes><broadcast_cluster/><use_common_script>true</use_common_script><credentials/><icon_filesize>1546</icon_filesize><icon>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</icon><credential_fr>0</credential_fr><description>Set up a Microsoft teams connections via a incoming web hook and then sends a message to this MT channel. The message is consisted by a title and a text. </description><environment_variables_fr>0</environment_variables_fr><agent_var/><icon_filename>msteams.png</icon_filename><sys_id>96ba9244e7ca44d58723045aa71bc0a8</sys_id><variable_prefix>var</variable_prefix><script_windows/><credentials_var_check>false</credentials_var_check><agent_fr>0</agent_fr><agent_var_check>false</agent_var_check><output_failure_only>false</output_failure_only><output_return_sline>1</output_return_sline><output_type>1</output_type><desktop_interact>false</desktop_interact><script_unix/><output_return_file/><run_as_sudo>false</run_as_sudo><broadcast_cluster_var/><environment/><elevate_user>false</elevate_user><exit_code_output/><exit_code_processing>1</exit_code_processing><create_console>false</create_console><related_items_node><ops_unv_tmplt_field action="INSERT_OR_UPDATE"><choice_sort_option>1</choice_sort_option><form_start_row>false</form_start_row><sys_updated_on>2019-12-12 12:13:15</sys_updated_on><boolean_value_type>1</boolean_value_type><required>true</required><field_mask/><boolean_no_value/><require_if_field/><sys_id>4d1b564af6664ee68b0359d35ddcf115</sys_id><require_if_field_value/><array_name_title/><sys_updated_by>i.kyriazidou</sys_updated_by><array_value_title/><sys_created_on>2019-12-12 12:13:15</sys_created_on><field_value/><no_space_if_hidden>false</no_space_if_hidden><require_if_visible>false</require_if_visible><sys_created_by>i.kyriazidou</sys_created_by><int_field_min/><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id><show_if_field/><boolean_yes_value/><form_col_span>1</form_col_span><field_length/><form_end_row>false</form_end_row><label>Incoming Web Hook</label><int_field_max/><choice_allow_empty>false</choice_allow_empty><sequence>0</sequence><show_if_field_value/><form_row_span>1</form_row_span><default_list_view>false</default_list_view><hint>The incoming web hook of Microsoft Teams channel.</hint><field_mapping>textField1</field_mapping><name>web_hook</name><field_regex/><field_type>1</field_type></ops_unv_tmplt_field><ops_unv_tmplt_field action="INSERT_OR_UPDATE"><choice_sort_option>1</choice_sort_option><form_start_row>false</form_start_row><sys_updated_on>2019-12-12 12:13:37</sys_updated_on><boolean_value_type>1</boolean_value_type><required>true</required><field_mask/><boolean_no_value/><require_if_field/><sys_id>a0327a62b1df4073b0dce09301eddac4</sys_id><require_if_field_value/><array_name_title/><sys_updated_by>i.kyriazidou</sys_updated_by><array_value_title/><sys_created_on>2019-12-12 12:13:37</sys_created_on><field_value/><no_space_if_hidden>false</no_space_if_hidden><require_if_visible>false</require_if_visible><sys_created_by>i.kyriazidou</sys_created_by><int_field_min/><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id><show_if_field/><boolean_yes_value/><form_col_span>1</form_col_span><field_length/><form_end_row>false</form_end_row><label>Message Title</label><int_field_max/><choice_allow_empty>false</choice_allow_empty><sequence>1</sequence><show_if_field_value/><form_row_span>1</form_row_span><default_list_view>false</default_list_view><hint>The title of the message sent to Microsoft Teams channel</hint><field_mapping>textField2</field_mapping><name>title</name><field_regex/><field_type>1</field_type></ops_unv_tmplt_field><ops_unv_tmplt_field action="INSERT_OR_UPDATE"><choice_sort_option>1</choice_sort_option><form_start_row>false</form_start_row><sys_updated_on>2019-12-12 12:13:54</sys_updated_on><boolean_value_type>1</boolean_value_type><required>true</required><field_mask/><boolean_no_value/><require_if_field/><sys_id>ac9a72c548d54cea953e0f3ccfc29ed8</sys_id><require_if_field_value/><array_name_title/><sys_updated_by>i.kyriazidou</sys_updated_by><array_value_title/><sys_created_on>2019-12-12 12:13:54</sys_created_on><field_value/><no_space_if_hidden>false</no_space_if_hidden><require_if_visible>false</require_if_visible><sys_created_by>i.kyriazidou</sys_created_by><int_field_min/><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id><show_if_field/><boolean_yes_value/><form_col_span>1</form_col_span><field_length/><form_end_row>false</form_end_row><label>Message Text</label><int_field_max/><choice_allow_empty>false</choice_allow_empty><sequence>2</sequence><show_if_field_value/><form_row_span>1</form_row_span><default_list_view>false</default_list_view><hint>The text of the message sent to Microsoft Teams channel</hint><field_mapping>textField3</field_mapping><name>text</name><field_regex/><field_type>1</field_type></ops_unv_tmplt_field><ops_unv_tmplt_field action="INSERT_OR_UPDATE"><choice_sort_option>1</choice_sort_option><form_start_row>false</form_start_row><sys_updated_on>2019-12-12 12:14:21</sys_updated_on><boolean_value_type>1</boolean_value_type><required>false</required><field_mask/><boolean_no_value/><require_if_field/><sys_id>e4dd0fadbe9e453b924c63c6409506e7</sys_id><require_if_field_value/><array_name_title/><sys_updated_by>i.kyriazidou</sys_updated_by><array_value_title/><sys_created_on>2019-12-12 12:14:21</sys_created_on><field_value>INFO</field_value><no_space_if_hidden>false</no_space_if_hidden><require_if_visible>false</require_if_visible><sys_created_by>i.kyriazidou</sys_created_by><int_field_min/><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id><show_if_field/><boolean_yes_value/><form_col_span>1</form_col_span><field_length/><form_end_row>false</form_end_row><label>Logging Level</label><int_field_max/><choice_allow_empty>false</choice_allow_empty><sequence>3</sequence><show_if_field_value/><form_row_span>1</form_row_span><default_list_view>false</default_list_view><hint>The logging level of this script.</hint><field_mapping>choiceField1</field_mapping><name>logging_level</name><field_regex/><field_type>4</field_type></ops_unv_tmplt_field><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>0cb73cda81dc447a9eb28ca099a92b39</sys_id><sequence>4</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:48</sys_created_on><field_value_label>FATAL</field_value_label><field_value>FATAL</field_value><sys_updated_on>2019-12-12 12:14:48</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>3751ed526b164cc691a84f76e52c3d5f</sys_id><sequence>3</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:42</sys_created_on><field_value_label>CRITICAL</field_value_label><field_value>CRITICAL</field_value><sys_updated_on>2019-12-12 12:14:42</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>669d3b35cb524296b3db1c19e1eb45a9</sys_id><sequence>5</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:53</sys_created_on><field_value_label>WARNING</field_value_label><field_value>WARNING</field_value><sys_updated_on>2019-12-12 12:14:53</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>7139021f819e46e7aa6b91a67a343eb0</sys_id><sequence>0</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:26</sys_created_on><field_value_label>INFO</field_value_label><field_value>INFO</field_value><sys_updated_on>2019-12-12 12:14:26</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>8ef1db0894de4b2b853176cae6c979e8</sys_id><sequence>2</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:36</sys_created_on><field_value_label>ERROR</field_value_label><field_value>ERROR</field_value><sys_updated_on>2019-12-12 12:14:36</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice><ops_unv_tmplt_field_choice action="INSERT_OR_UPDATE"><field_id>e4dd0fadbe9e453b924c63c6409506e7</field_id><use_field_value_for_label>true</use_field_value_for_label><sys_id>9be5c0a792a743a29c44763e72518b18</sys_id><sequence>1</sequence><sys_updated_by>i.kyriazidou</sys_updated_by><sys_created_on>2019-12-12 12:14:32</sys_created_on><field_value_label>DEBUG</field_value_label><field_value>DEBUG</field_value><sys_updated_on>2019-12-12 12:14:32</sys_updated_on><sys_created_by>i.kyriazidou</sys_created_by><universal_template_id>96ba9244e7ca44d58723045aa71bc0a8</universal_template_id></ops_unv_tmplt_field_choice></related_items_node></ops_unv_tmplt></unload>